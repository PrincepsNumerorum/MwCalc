<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>数学基礎講座：一次不等式・二次不等式（統合版）</title>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    window.MathJax = {
        tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
        svg: { fontCache: 'global' }
    };
</script>

<style>
    :root {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --accent-primary: #00d2ff; /* Cyber Blue */
        --accent-secondary: #ff007a; /* Neon Pink */
        --accent-tertiary: #00ff9d; /* Neon Green */
        --accent-warn: #ffcc00; /* Warning Yellow */
        --panel-bg: #1e1e1e;
        --slide-padding: 40px;
    }

    body {
        margin: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", sans-serif;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }

    /* Presentation Container */
    #deck {
        position: relative;
        width: 100%;
        height: 100%;
        perspective: 1000px;
    }

    .slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        padding: var(--slide-padding);
        
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        
        opacity: 0;
        pointer-events: none;
        transform: translate3d(50px, 0, 0);
        transition: opacity 0.4s ease, transform 0.4s ease;
        z-index: 0;
        overflow-y: auto; 
    }

    .slide::-webkit-scrollbar { width: 8px; }
    .slide::-webkit-scrollbar-track { background: transparent; }
    .slide::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

    .slide.active {
        opacity: 1;
        pointer-events: auto;
        transform: translate3d(0, 0, 0);
        z-index: 10;
    }

    .slide.past {
        opacity: 0;
        transform: translate3d(-50px, 0, 0);
    }

    /* Typography */
    h1 { font-size: 2.8rem; margin: 0 0 20px 0; color: var(--accent-primary); text-align: center; line-height: 1.2; text-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }
    h2 { font-size: 2rem; margin-bottom: 20px; border-bottom: 2px solid var(--accent-primary); color: #fff; display: inline-block; padding-bottom: 5px; text-align: center;}
    h3 { font-size: 1.5rem; color: var(--accent-tertiary); margin: 10px 0; }
    p, li { font-size: 1.4rem; line-height: 1.5; margin-bottom: 0.6rem; max-width: 95%; }
    
    ul { list-style: none; padding: 0; margin: 0; }
    li { position: relative; padding-left: 1.2em; margin-bottom: 0.5em; }
    li::before { content: "➤"; position: absolute; left: 0; color: var(--accent-primary); font-size: 0.8em; top: 0.2em; }

    .highlight { color: var(--accent-secondary); font-weight: bold; }
    .important { color: var(--accent-tertiary); font-weight: bold; border-bottom: 2px solid var(--accent-tertiary); }
    .warn { color: var(--accent-warn); font-weight: bold; }
    .note { font-size: 1rem; color: #888; margin-top: 10px; }

    /* Box Styles */
    .box {
        background: var(--panel-bg);
        border: 1px solid #444;
        border-radius: 12px;
        padding: 15px 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        margin: 10px 0;
        text-align: center;
        width: fit-content;
        min-width: 300px;
        max-width: 90%;
    }

    /* Fragment Animation */
    .fragment {
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease-out;
    }
    .fragment.visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* Interactive Elements & SVG */
    .interactive-area {
        background: #000;
        border: 1px solid #333;
        border-radius: 15px;
        padding: 15px;
        margin-top: 10px;
        text-align: center;
        box-shadow: inset 0 0 40px rgba(0,0,0,0.8);
        width: 100%;
        max-width: 800px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    svg { 
        overflow: visible; 
        width: 100%; 
        height: auto;
        max-height: 40vh;
        display: block;
        margin: 0 auto;
    }

    input[type=range], input[type=number] { width: 100%; margin: 10px 0; cursor: pointer; accent-color: var(--accent-primary); padding: 5px; font-size: 1.2rem; background: #333; color: white; border: 1px solid #555; border-radius: 5px;}

    /* Controls */
    #controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 100;
    }
    .btn {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 1rem;
        transition: all 0.2s;
        backdrop-filter: blur(5px);
    }
    .btn:hover { background: var(--accent-primary); color: #000; border-color: var(--accent-primary); }

    #progress-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        height: 5px;
        background: var(--accent-primary);
        width: 0%;
        transition: width 0.3s;
        z-index: 100;
    }

    #slide-number {
        position: fixed;
        bottom: 20px;
        left: 20px;
        color: #555;
        font-size: 1.2rem;
        font-family: monospace;
    }

    .row { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; width: 100%; }
    .col { flex: 1; min-width: 250px; }
    
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 1.4rem; }
    th, td { border: 1px solid #444; padding: 10px; text-align: center; vertical-align: middle;}
    th { background: #333; color: var(--accent-primary); }
    td { background: rgba(255,255,255,0.05); }

    /* Quiz Styles */
    .quiz-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 900px; }
    .quiz-item { background: #222; padding: 15px; border-radius: 8px; border: 1px solid #444; cursor: pointer; transition: 0.3s; }
    .quiz-item:hover { background: #333; border-color: var(--accent-primary); }
    .quiz-q { font-weight: bold; margin-bottom: 10px; font-size: 1.2rem; }
    .quiz-a { display: none; color: var(--accent-tertiary); margin-top: 10px; border-top: 1px solid #555; padding-top: 5px; font-size: 1.2rem;}
    .quiz-item.revealed .quiz-a { display: block; }
    
    /* Animation helper classes from quadratic part */
    .anim-box { stroke: var(--accent-primary); stroke-width: 2; fill: rgba(0, 210, 255, 0.2); transition: all 0.5s; }
    .anim-rect { stroke: var(--accent-secondary); stroke-width: 2; fill: rgba(255, 0, 122, 0.2); transition: all 0.5s; }
    .anim-target { stroke: var(--accent-tertiary); stroke-width: 2; fill: none; stroke-dasharray: 5; }
    .anim-fill { fill: var(--accent-tertiary); opacity: 0; transition: opacity 0.5s; }
    
    /* Slider Groups */
    .slider-container {
        width: 95%;
        max-width: 600px;
        margin: 10px auto;
        background: rgba(255,255,255,0.05);
        padding: 10px;
        border-radius: 10px;
    }
    .slider-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 5px;
    }
    .slider-label {
        width: 60px;
        font-weight: bold;
        text-align: right;
        font-family: monospace;
        font-size: 1.1rem;
    }

</style>
</head>
<body>

<div id="deck">

    <div class="slide active">
        <h1>数学基礎講座</h1>
        <p style="letter-spacing: 0.2em; color: #888;">MATH BASICS: INEQUALITIES</p>
        <div class="box" style="margin-top: 30px;">
            <p style="margin:0.5em 0;">第1部：世界を「範囲」で捉える技術</p>
            <p style="margin:0.5em 0; font-size: 2.2rem; color: var(--accent-primary);">一次不等式と<br>二次関数の構造</p>
        </div>
        <p style="font-size: 1rem; margin-top: 40px; opacity: 0.6;">[→] キーまたは右下のボタンで開始</p>
    </div>

    <div class="slide">
        <h2>1. 等式から不等式へ</h2>
        <p>いきなりですが、お買い物です。</p>
        <div class="box fragment">
            <p><strong>所持金：500円</strong></p>
            <p><strong>本の値段：300円</strong></p>
        </div>
        <p class="fragment">もし「残りのおつりはいくら？」と聞かれたら、<br>等式（＝）を使います。</p>
        <div class="box fragment">
            <p>$500 - 300 = 200$</p>
        </div>
    </div>

    <div class="slide">
        <h2>「足りるか？」が知りたい時</h2>
        <p>でも、日常生活で本当に知りたいのは、<br>「正確な残り」よりも<strong>「買えるかどうか」</strong>ではありませんか？</p>
        <div class="fragment">
            <p>500円持っていて、300円の本を買う。</p>
            <p style="font-size: 2rem; color: var(--accent-tertiary);">$500 \ge 300$</p>
        </div>
        <p class="fragment">「所持金の方が大きい（あるいは同じ）」ならば買えます。<br>これが<strong>不等式の概念</strong>です。</p>
    </div>

    <div class="slide">
        <h2>世界の切り取り方</h2>
        <div class="row">
            <div class="col box fragment">
                <h3>等式 (=)</h3>
                <p>ピンポイントで特定する</p>
                <p>「正解はこれ一つ！」</p>
                <p style="color:#888;">例：身長が170.0cmジャスト</p>
            </div>
            <div class="col box fragment">
                <h3>不等式 (>, <)</h3>
                <p>範囲で捉える</p>
                <p>「だいたいこの辺より上！」</p>
                <p style="color:#888;">例：170cm以上の人すべて</p>
            </div>
        </div>
        <p class="fragment" style="margin-top:20px;">現実は「範囲」で動いていることの方が多いのです。</p>
    </div>

    <div class="slide">
        <h2>2. 日常生活にあふれる不等式</h2>
        <p>意識していないだけで、私たちは不等式を使っています。</p>
        <ul>
            <li class="fragment"><strong>年齢制限：</strong> ゲームは12歳以上 ($x \ge 12$)</li>
            <li class="fragment"><strong>スマホ容量：</strong> 写真が2GB以上あると保存不可 ($x \ge 2GB$)</li>
            <li class="fragment"><strong>テスト：</strong> 60点以上で合格 ($x \ge 60$)</li>
        </ul>
    </div>

    <div class="slide">
        <h2>【歴史トリビア】誰が作った？</h2>
        <p>等号 ($=$) は、1557年にイギリスのレコードという人が<br>「2本の平行線ほど等しいものはない」として作りました。</p>
        <div class="box fragment">
            <p>では、不等号 ($>, <$) は？</p>
        </div>
        <p class="fragment">1631年、同じくイギリスの<strong>ハリオット</strong>という数学者が、<br>「等号の平行線を、大小関係に合わせて変形させた」<br>といわれています（諸説あり）。</p>
    </div>

    <div class="slide">
        <h2>3. 天秤で感じる不等式</h2>
        <p>不等式のイメージは「天秤」です。</p>
        <p>重いほうが下がります。</p>
        <div class="interactive-area">
            <svg id="scale-svg" viewBox="0 0 400 200">
                <path d="M 200 180 L 180 200 L 220 200 Z" fill="#555"/>
                <line x1="200" y1="180" x2="200" y2="50" stroke="#888" stroke-width="4"/>
                
                <g id="scale-arm" style="transition: transform 1s cubic-bezier(0.4, 2, 0.55, 1);">
                    <line x1="50" y1="50" x2="350" y2="50" stroke="#ddd" stroke-width="4"/>
                    <line x1="50" y1="50" x2="50" y2="100" stroke="#888"/>
                    <rect x="20" y="100" width="60" height="10" fill="#555"/>
                    <g id="left-weights"></g>
                    <line x1="350" y1="50" x2="350" y2="100" stroke="#888"/>
                    <rect x="320" y="100" width="60" height="10" fill="#555"/>
                    <g id="right-weights"></g>
                </g>
                
                <circle cx="200" cy="50" r="5" fill="var(--accent-primary)"/>
            </svg>
            <div style="margin-top:10px;">
                <button class="btn" onclick="addWeight('left')">左に重りを乗せる</button>
                <button class="btn" onclick="addWeight('right')">右に重りを乗せる</button>
                <button class="btn" onclick="resetScale()">リセット</button>
            </div>
            <p id="scale-status" style="font-size: 1.5rem; margin-top:10px;">左右はつり合っています (=)</p>
        </div>
    </div>

    <div class="slide">
        <h2>天秤の動きを見てみよう</h2>
        <p>左側が重いとき、不等号は <strong>＞</strong> （左が開いている）になります。</p>
        <p class="fragment">口が開いている方が「大きい（重い）」と覚えましょう。</p>
        <div class="box fragment">
            <p style="font-size: 3rem;">左 ＞ 右</p>
        </div>
        <p class="fragment">逆に、右側が重いときは <strong>＜</strong> となります。</p>
    </div>

    <div class="slide">
        <h2>式で書くと？</h2>
        <p>例えば、左皿に「$x$g のりんご」と「100gの重り」、<br>右皿に「300gの重り」が乗っていて、<br>左の方が重い場合：</p>
        <div class="box fragment">
            <p>$x + 100 > 300$</p>
        </div>
        <p class="fragment">これが「不等式を立てる」ということです。</p>
    </div>

    <div class="slide">
        <h2>4. 4つの記号をマスターする</h2>
        <p>似ているようで、少し違います。ここが最初のつまづきポイントです。</p>
        <table>
            <tr><th>記号</th><th>読み方</th><th>境界</th></tr>
            <tr class="fragment"><td>$a > b$</td><td>aはbより大きい</td><td>含まない</td></tr>
            <tr class="fragment"><td>$a < b$</td><td>aはbより小さい</td><td>含まない</td></tr>
            <tr class="fragment"><td>$a \ge b$</td><td>aはb以上</td><td><span class="highlight">含む</span></td></tr>
            <tr class="fragment"><td>$a \le b$</td><td>aはb以下</td><td><span class="highlight">含む</span></td></tr>
        </table>
    </div>

    <div class="slide">
        <h2>「含む」か「含まない」か</h2>
        <p>日本語のニュアンスに注意してください。</p>
        <div class="row">
            <div class="col box fragment">
                <h3>より大きい / 小さい</h3>
                <p>その数は入らない！</p>
                <p>$x > 3$ なら、<br>3はダメ。3.1はOK。</p>
            </div>
            <div class="col box fragment" style="border-color: var(--accent-secondary);">
                <h3>以上 / 以下</h3>
                <p>その数も入る！</p>
                <p>$x \ge 3$ なら、<br>3もOK。3.1もOK。</p>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>数直線での描き方（重要）</h2>
        <p>世界共通の「描き分けルール」があります。</p>
        <div class="box">
            <p>含まない ($>, <$)：<strong>白丸</strong> ＋ <strong>斜め線</strong></p>
            <p>含む ($\ge, \le$)：<strong>黒丸</strong> ＋ <strong>垂直線</strong></p>
        </div>
        <p class="note">※垂直に立ち上がることで「その点もしっかり押さえている」感を出します。</p>
    </div>

    <div class="slide">
        <h2>例：$x > 2$ （2より大きい）</h2>
        <p>「2」を含まないので、<strong>白丸</strong>で、そこから逃げるように<strong>斜め</strong>に線を引きます。</p>
        <div class="interactive-area">
            <svg viewBox="0 0 400 100">
                <line x1="20" y1="80" x2="380" y2="80" stroke="#888" stroke-width="2"/>
                <text x="200" y="110" fill="#fff" text-anchor="middle">2</text>
                <circle cx="200" cy="80" r="8" stroke="var(--accent-primary)" stroke-width="3" fill="#000"/>
                <line x1="206" y1="74" x2="230" y2="30" stroke="var(--accent-primary)" stroke-width="3"/> <line x1="230" y1="30" x2="380" y2="30" stroke="var(--accent-primary)" stroke-width="3" marker-end="url(#arrow-p)"/>
                
                <defs>
                    <marker id="arrow-p" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="var(--accent-primary)" /></marker>
                </defs>
            </svg>
        </div>
    </div>

    <div class="slide">
        <h2>例：$x \ge 2$ （2以上）</h2>
        <p>「2」を含むので、<strong>黒丸</strong>で塗りつぶし、そこから<strong>垂直</strong>に立ち上げます。</p>
        <div class="interactive-area">
            <svg viewBox="0 0 400 100">
                <line x1="20" y1="80" x2="380" y2="80" stroke="#888" stroke-width="2"/>
                <text x="200" y="110" fill="#fff" text-anchor="middle">2</text>
                <circle cx="200" cy="80" r="8" fill="var(--accent-secondary)"/>
                <line x1="200" y1="80" x2="200" y2="30" stroke="var(--accent-secondary)" stroke-width="3"/> <line x1="200" y1="30" x2="380" y2="30" stroke="var(--accent-secondary)" stroke-width="3" marker-end="url(#arrow-s)"/>

                <defs>
                    <marker id="arrow-s" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="var(--accent-secondary)" /></marker>
                </defs>
            </svg>
        </div>
    </div>

    <div class="slide">
        <h2>違いを目に焼き付ける</h2>
        <div class="row">
            <div class="col">
                <svg viewBox="0 0 200 100" style="border:1px solid #333;">
                    <text x="100" y="20" fill="#fff" text-anchor="middle">$x < 3$</text>
                    <line x1="10" y1="80" x2="190" y2="80" stroke="#888"/>
                    <circle cx="100" cy="80" r="6" stroke="var(--accent-primary)" stroke-width="2" fill="#000"/>
                    <line x1="96" y1="76" x2="80" y2="40" stroke="var(--accent-primary)" stroke-width="2"/>
                    <line x1="80" y1="40" x2="10" y2="40" stroke="var(--accent-primary)" stroke-width="2"/>
                </svg>
                <p>白丸・斜め</p>
            </div>
            <div class="col">
                <svg viewBox="0 0 200 100" style="border:1px solid #333;">
                    <text x="100" y="20" fill="#fff" text-anchor="middle">$x \le 3$</text>
                    <line x1="10" y1="80" x2="190" y2="80" stroke="#888"/>
                    <circle cx="100" cy="80" r="6" fill="var(--accent-secondary)"/>
                    <line x1="100" y1="80" x2="100" y2="40" stroke="var(--accent-secondary)" stroke-width="2"/>
                    <line x1="100" y1="40" x2="10" y2="40" stroke="var(--accent-secondary)" stroke-width="2"/>
                </svg>
                <p>黒丸・垂直</p>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>5. 一次不等式とは</h2>
        <div class="box">
            <p>文字が1つで、次数が1（$x^2$とかじゃない）不等式</p>
        </div>
        <p class="fragment">例：<br>$x > 5$ <span class="highlight">（〇）</span><br>$x^2 > 5$ <span class="warn">（× 二次不等式）</span><br>$x + y > 5$ <span class="warn">（× 文字が2つ）</span></p>
    </div>

    <div class="slide">
        <h2>6. 不等式の計算ルール</h2>
        <p>基本は、等式（方程式）と同じです。</p>
        <div class="box fragment">
            <p>$x - 3 > 5$</p>
            <p>$\downarrow$ 両辺に $+3$</p>
            <p>$x > 8$</p>
        </div>
        <p class="fragment">移項もできます。</p>
    </div>

    <div class="slide">
        <h2>変わらないもの</h2>
        <ul>
            <li class="fragment">同じ数を<strong>足す</strong> $\to$ 向きは変わらない</li>
            <li class="fragment">同じ数を<strong>引く</strong> $\to$ 向きは変わらない</li>
            <li class="fragment"><strong>正の数</strong>を掛ける/割る $\to$ 向きは変わらない</li>
        </ul>
        <p class="fragment" style="margin-top:30px;">これらは等式と同じように処理できます。</p>
    </div>

    <div class="slide">
        <h2>7. 唯一にして最大の罠</h2>
        <div class="box" style="border-color: var(--accent-warn);">
            <p style="font-size:2rem; color: var(--accent-warn);">負の数を掛けたり割ったりすると<br>不等号の向きが逆になる！</p>
        </div>
        <p>なぜでしょうか？<br>「そういうルールだから」で済ませずに、納得しましょう。</p>
    </div>

    <div class="slide">
        <h2>「マイナスを掛ける」の意味</h2>
        <p>数直線において、マイナスを掛けるとは<br><strong>「原点0を中心に世界を反転させる」</strong>ことです。</p>
        <div class="interactive-area" style="height:250px;">
            <svg id="flip-svg" viewBox="-200 -50 400 100">
                <line x1="-190" y1="0" x2="190" y2="0" stroke="#888"/>
                <line x1="0" y1="-10" x2="0" y2="10" stroke="#fff"/>
                <text x="0" y="30" fill="#fff" text-anchor="middle">0</text>
                
                <g id="flip-obj">
                    <circle cx="50" cy="0" r="5" fill="var(--accent-primary)"/>
                    <text x="50" y="-15" fill="var(--accent-primary)" text-anchor="middle">1</text>
                    <circle cx="150" cy="0" r="5" fill="var(--accent-secondary)"/>
                    <text x="150" y="-15" fill="var(--accent-secondary)" text-anchor="middle">3</text>
                    <text x="100" y="-35" fill="#fff" text-anchor="middle" font-size="20">1 < 3</text>
                </g>
            </svg>
            <input type="range" id="flip-slider" min="0" max="180" value="0" step="1" oninput="updateFlip()">
            <p>スライダーを動かして、$-1$ を掛けてみましょう。</p>
        </div>
    </div>

    <div class="slide">
        <h2>大小関係が逆転した！</h2>
        <div class="row">
            <div class="col box">
                <h3>元の世界</h3>
                <p>$1 < 3$</p>
                <p>3の方が右にある（大きい）</p>
            </div>
            <div class="col box" style="border-color: var(--accent-warn);">
                <h3>反転した世界</h3>
                <p>$-1 > -3$</p>
                <p>-1の方が右に来た（大きい）</p>
            </div>
        </div>
        <p class="fragment">大きい数ほど、反転すると左の奥（小さい方）へ行ってしまうからです。</p>
    </div>

    <div class="slide">
        <h2>計算練習：負の数</h2>
        <p>例： $-2x > 6$</p>
        <div class="box fragment">
            <p>① $-2$ で両辺を割る</p>
            <p>② 負の数で割ったので、向きを<strong>逆</strong>にする</p>
            <p style="font-size: 2rem; color: var(--accent-warn);">$x < -3$</p>
        </div>
    </div>

    <div class="slide">
        <h2>計算練習：負の数 2</h2>
        <p>例： $-x \le -5$</p>
        <div class="box fragment">
            <p>① $-1$ を両辺に掛ける（または割る）</p>
            <p>② 負の数なので、向きを<strong>逆</strong>にする</p>
            <p>$\le$ の逆は $\ge$ です。</p>
            <p style="font-size: 2rem; color: var(--accent-warn);">$x \ge 5$</p>
        </div>
    </div>

    <div class="slide">
        <h2>不等式計算まとめ</h2>
        <ul>
            <li>移項はそのまま OK</li>
            <li>正の掛け算・割り算はそのまま OK</li>
            <li class="warn">負の掛け算・割り算だけ「ひっくり返す」！</li>
        </ul>
    </div>

    <div class="slide">
        <h2>8. 皆で解く一次不等式</h2>
        <p>まずは基本問題を一緒にやってみましょう。</p>
    </div>

    <div class="slide">
        <h2>第1問</h2>
        <p>$x - 4 \ge 1$</p>
        <div class="fragment box">
            <p>$-4$ を右に移項します（符号が変わる）。</p>
            <p>$x \ge 1 + 4$</p>
            <p class="highlight" style="font-size:2rem;">$x \ge 5$</p>
        </div>
    </div>

    <div class="slide">
        <h2>第2問</h2>
        <p>$2x + 1 > x + 4$</p>
        <div class="fragment box" style="text-align: left;">
            <p>① $x$ を左へ、$1$ を右へ移項</p>
            <p style="padding-left:20px;">$2x - x > 4 - 1$</p>
            <p>② 計算する</p>
            <p style="padding-left:20px;" class="highlight">$x > 3$</p>
        </div>
    </div>

    <div class="slide">
        <h2>9. 各自で解く練習問題</h2>
        <p>ここからはクイズ形式です。<br>ノートに解いてからクリックして答え合わせをしてください。</p>
    </div>

    <div class="slide">
        <h2>練習問題 (1/3)</h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(1) $x + 5 < 9$</div>
                <div class="quiz-a">移項して $x < 9 - 5$<br><strong>答え： $x < 4$</strong></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(2) $3x \le 12$</div>
                <div class="quiz-a">3で割る（正なのでそのまま）<br><strong>答え： $x \le 4$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>練習問題 (2/3)</h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(3) $2x - 3 > 5$</div>
                <div class="quiz-a">$2x > 8$<br>2で割って<br><strong>答え： $x > 4$</strong></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(4) $4x + 1 \le 2x + 7$</div>
                <div class="quiz-a">$4x - 2x \le 7 - 1$<br>$2x \le 6$<br><strong>答え： $x \le 3$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>練習問題 (3/3) <span class="warn">注意！</span></h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(5) $-2x > 6$</div>
                <div class="quiz-a">$-2$で割るから向き逆転！<br><strong>答え： $x < -3$</strong></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(6) $5 - x \le 2$</div>
                <div class="quiz-a">$-x \le 2 - 5$<br>$-x \le -3$<br>$-1$を掛けて逆転！<br><strong>答え： $x \ge 3$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>10. 連立不等式とは</h2>
        <p>「あれも満たして、これも満たす」という状態です。</p>
        <div class="box fragment">
            <p>条件A： $x > 1$</p>
            <p>かつ</p>
            <p>条件B： $x \le 4$</p>
        </div>
        <p class="fragment">この2つが<strong>「重なっている場所（共通範囲）」</strong>が答えです。</p>
    </div>

    <div class="slide">
        <h2>共通範囲を探せ</h2>
        <p>$\begin{cases} x > 1 \\ x \le 4 \end{cases}$</p>
        <div class="interactive-area">
            <svg viewBox="0 0 400 120">
                <line x1="20" y1="100" x2="380" y2="100" stroke="#fff" stroke-width="2"/>
                
                <g class="fragment">
                    <polygon points="100,100 110,60 380,60 380,100" fill="var(--accent-primary)" opacity="0.2"/>
                    <circle cx="100" cy="100" r="6" stroke="var(--accent-primary)" stroke-width="2" fill="#000"/>
                    <line x1="104" y1="94" x2="110" y2="60" stroke="var(--accent-primary)" stroke-width="2"/> <line x1="110" y1="60" x2="380" y2="60" stroke="var(--accent-primary)" stroke-width="2"/>
                    <text x="100" y="130" fill="white" text-anchor="middle">1</text>
                </g>

                <g class="fragment">
                    <line x1="300" y1="100" x2="300" y2="40" stroke="var(--accent-secondary)" stroke-width="2"/>
                    <circle cx="300" cy="100" r="6" fill="var(--accent-secondary)"/>
                    <line x1="300" y1="40" x2="20" y2="40" stroke="var(--accent-secondary)" stroke-width="2"/>
                    <text x="300" y="130" fill="white" text-anchor="middle">4</text>
                    <rect x="20" y="40" width="280" height="60" fill="var(--accent-secondary)" opacity="0.2"/>
                </g>
            </svg>
        </div>
        <p class="fragment">色が重なって濃くなっている部分が答えです。<br><span class="highlight">$1 < x \le 4$</span></p>
    </div>

    <div class="slide">
        <h2>重ならない場合もある</h2>
        <p>$\begin{cases} x < 1 \\ x > 3 \end{cases}$</p>
        <div class="interactive-area">
            <svg viewBox="0 0 400 100">
                <line x1="20" y1="80" x2="380" y2="80" stroke="#fff"/>
                <line x1="100" y1="80" x2="100" y2="50" stroke="var(--accent-primary)"/>
                <circle cx="100" cy="80" r="5" stroke="var(--accent-primary)" fill="#000"/>
                <line x1="100" y1="50" x2="20" y2="50" stroke="var(--accent-primary)"/>
                <line x1="300" y1="80" x2="300" y2="50" stroke="var(--accent-secondary)"/>
                <circle cx="300" cy="80" r="5" stroke="var(--accent-secondary)" fill="#000"/>
                <line x1="300" y1="50" x2="380" y2="50" stroke="var(--accent-secondary)"/>
            </svg>
        </div>
        <p>重なりがないので、答えは<strong>「解なし」</strong>です。</p>
    </div>

    <div class="slide">
        <h2>11. 皆で解く連立不等式</h2>
        <p>$\begin{cases} 2x > 4 & \cdots ① \\ x + 2 \le 5 & \cdots ② \end{cases}$</p>
        <div class="box fragment" style="text-align:left;">
            <p>まず、それぞれ別に解きます。</p>
            <p>①より： $x > 2$</p>
            <p>②より： $x \le 3$</p>
        </div>
        <p class="fragment">最後に数直線で合体！ $\to 2 < x \le 3$</p>
    </div>

    <div class="slide">
        <h2>12. 連立不等式 演習 (1/3)</h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(1) $\begin{cases} x \ge 0 \\ x < 5 \end{cases}$</div>
                <div class="quiz-a">数直線をイメージして…<br><strong>答え： $0 \le x < 5$</strong></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(2) $\begin{cases} x > -2 \\ x \le 3 \end{cases}$</div>
                <div class="quiz-a">重なりを探して…<br><strong>答え： $-2 < x \le 3$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>連立不等式 演習 (2/3)</h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(3) $\begin{cases} 2x > 2 \\ x < 4 \end{cases}$</div>
                <div class="quiz-a">$x > 1$ と $x < 4$<br><strong>答え： $1 < x < 4$</strong></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(4) $\begin{cases} x-1 \ge 0 \\ x+2 \le 6 \end{cases}$</div>
                <div class="quiz-a">$x \ge 1$ と $x \le 4$<br><strong>答え： $1 \le x \le 4$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>連立不等式 演習 (3/3)</h2>
        <div class="quiz-container">
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(5) $\begin{cases} -x < 3 \\ x \ge -1 \end{cases}$</div>
                <div class="quiz-a">上は向き逆転で $x > -3$。<br>下は $x \ge -1$。<br>重なりは？<br><strong>答え： $x \ge -1$</strong><br><span style="font-size:0.8em">(-1以上なら-3より大きいは当然満たす)</span></div>
            </div>
            <div class="quiz-item" onclick="this.classList.toggle('revealed')">
                <div class="quiz-q">(6) $\begin{cases} 3x-3 \ge 0 \\ x \le 5 \end{cases}$</div>
                <div class="quiz-a">$3x \ge 3 \to x \ge 1$<br>これと $x \le 5$<br><strong>答え： $1 \le x \le 5$</strong></div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>【ツール】不等式ビジュアライザー</h2>
        <p>式をいじって、数直線での見え方を確認しましょう。</p>
        <p>形： $ax + b > 0$ （または $<, \ge, \le$）</p>
    </div>

    <div class="slide">
        <h2>不等式ビジュアライザー</h2>
        <div class="interactive-area" style="width:90%;">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px; font-size:1.5rem;">
                <input type="number" id="tool-a" value="3" style="width:60px;" oninput="updateTool()">
                <span>$x +$</span>
                <input type="number" id="tool-b" value="-4" style="width:60px;" oninput="updateTool()">
                <select id="tool-op" style="font-size:1.5rem; background:#333; color:white; padding:5px;" onchange="updateTool()">
                    <option value="gt">&gt;</option>
                    <option value="lt">&lt;</option>
                    <option value="ge">&ge;</option>
                    <option value="le">&le;</option>
                </select>
                <span>$0$</span>
            </div>
            
            <p id="tool-step1" style="color:var(--accent-tertiary);">式： </p>
            <p id="tool-step2">移項： </p>
            <p id="tool-ans" style="font-size:1.8rem; font-weight:bold; color:var(--accent-primary);">解： </p>

            <svg id="tool-svg" viewBox="0 0 400 120" style="margin-top:20px; border-top:1px solid #444;">
                </svg>
        </div>
    </div>

    <div class="slide">
        <h2>連立不等式ビジュアライザー</h2>
        <div class="interactive-area" style="width:90%;">
            <div style="display:flex; flex-direction:column; gap:10px; font-size:1.2rem; width:100%;">
                <div style="display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span>①</span>
                    <input type="number" id="sim-a1" value="1" style="width:50px;" oninput="updateSimTool()">
                    <span>$x +$</span>
                    <input type="number" id="sim-b1" value="-2" style="width:50px;" oninput="updateSimTool()">
                    <select id="sim-op1" style="background:#333; color:white;" onchange="updateSimTool()">
                        <option value="gt">&gt;</option>
                        <option value="lt">&lt;</option>
                        <option value="ge">&ge;</option>
                        <option value="le">&le;</option>
                    </select>
                    <span>$0$</span>
                </div>
                <div style="display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span>②</span>
                    <input type="number" id="sim-a2" value="-1" style="width:50px;" oninput="updateSimTool()">
                    <span>$x +$</span>
                    <input type="number" id="sim-b2" value="4" style="width:50px;" oninput="updateSimTool()">
                    <select id="sim-op2" style="background:#333; color:white;" onchange="updateSimTool()">
                        <option value="gt">&gt;</option>
                        <option value="lt">&lt;</option>
                        <option value="ge">&ge;</option>
                        <option value="le">&le;</option>
                    </select>
                    <span>$0$</span>
                </div>
            </div>
            
            <p id="sim-result-text" style="font-size:1.4rem; color:var(--accent-tertiary); margin:10px 0;">共通範囲： </p>
            
            <svg id="sim-svg" viewBox="0 0 400 150" style="margin-top:10px; border-top:1px solid #444;">
                </svg>
        </div>
    </div>

    <div class="slide">
        <h1 style="color: var(--accent-secondary);">第2部<br>二次関数とグラフの構造</h1>
    </div>

    <div class="slide">
        <h2>そもそも二次関数とは？</h2>
        <p>$y = x^2$ のように、xを2回かけたものが主役の関数です。</p>
        <div class="box fragment">
            <p>x (1辺) $\to$ y (正方形の面積)</p>
            <ul>
                <li>$x=1$ のとき、$y = 1 \times 1 = 1$</li>
                <li>$x=2$ のとき、$y = 2 \times 2 = 4$</li>
                <li>$x=3$ のとき、$y = 3 \times 3 = 9$</li>
            </ul>
        </div>
        <p class="fragment">急激に増えていくのが特徴です。</p>
    </div>

    <div class="slide">
        <h2>グラフの描き方（順々プロット）</h2>
        <p>計算結果 $(x, y)$ を一つずつプロットすると、曲線が現れます。</p>
        <div class="interactive-area" style="height: 400px;">
            <svg id="svg-plot" viewBox="-4 -2 8 13" style="background:#111; height:100%; width:auto; border:1px solid #333;">
                <defs>
                    <pattern id="grid" width="1" height="1" patternUnits="userSpaceOnUse">
                        <path d="M 1 0 L 0 0 0 1" fill="none" stroke="#222" stroke-width="0.05"/>
                    </pattern>
                </defs>
                <rect x="-4" y="-2" width="8" height="15" fill="url(#grid)" />
                <line x1="-4" y1="0" x2="4" y2="0" stroke="#888" stroke-width="0.05"/>
                <line x1="0" y1="-2" x2="0" y2="10" stroke="#888" stroke-width="0.05"/>
                <text x="3.5" y="-0.2" font-size="0.5" fill="#888">x</text>
                <text x="0.2" y="10" font-size="0.5" fill="#888">y</text>
                <text x="-0.3" y="-0.2" font-size="0.5" fill="#888">0</text>
                <g id="plot-points"></g>
                <path id="plot-line" d="" stroke="var(--accent-primary)" stroke-width="0.1" fill="none"/>
                <text id="plot-status" x="0" y="-1.5" font-size="0.6" fill="white" text-anchor="middle"></text>
            </svg>
            <button class="btn" onclick="runPlotAnimation()" style="margin-top:10px;">プロット開始</button>
        </div>
    </div>

    <div class="slide">
        <h1 style="color: var(--accent-tertiary);">第3部<br>平方完成の「魔法」</h1>
        <p>一般形 $ax^2+bx+c$ から 標準形 $a(x-p)^2+q$ へ</p>
    </div>

    <div class="slide">
        <h2>「一般形」は使いにくい？</h2>
        <p>$y = x^2 + 4x + 3$ （一般形）</p>
        <div class="box fragment">
            <p>この式だけ見ても、<br><strong>「頂点がどこにあるか」</strong><br>パッとは分かりません。</p>
        </div>
        <p class="fragment">グラフを自由に動かすために、式の形を変身させる必要があります。<br>それが<span class="important">平方完成</span>です。</p>
    </div>

    <div class="slide">
        <h2>平方完成の正体</h2>
        <div class="box">
            <p style="font-size:1.8rem;">中途半端な長方形を、<br><span class="highlight">正方形に作り直す</span>作業</p>
        </div>
        <p>面積図のパズルとして理解しましょう。</p>
    </div>

    <div class="slide">
        <h2>視覚的平方完成：アニメーション</h2>
        <div class="interactive-area" style="height: 350px;">
            <svg id="svg-square" viewBox="0 0 400 300">
                <rect id="sq-x2" class="anim-box" x="100" y="50" width="100" height="100" />
                <text x="150" y="100" fill="white" text-anchor="middle" font-size="20">x²</text>
                <g id="grp-4x">
                    <rect class="anim-rect" x="205" y="50" width="80" height="100" />
                    <text x="245" y="100" fill="white" text-anchor="middle" font-size="20">4x</text>
                </g>
                <g id="grp-split" opacity="0">
                    <rect id="rect-r" class="anim-rect" x="205" y="50" width="40" height="100" />
                    <text id="txt-r" x="225" y="40" fill="var(--accent-secondary)" text-anchor="middle" font-size="16">2</text>
                    <rect id="rect-b" class="anim-rect" x="250" y="50" width="40" height="100" />
                </g>
                <rect id="sq-missing" class="anim-target" x="205" y="155" width="40" height="40" opacity="0"/>
                <rect id="sq-fill" class="anim-fill" x="205" y="155" width="40" height="40" />
                <text id="txt-missing" x="225" y="180" fill="var(--accent-tertiary)" text-anchor="middle" opacity="0">?</text>
            </svg>
            <div style="margin-top:10px;">
                <button class="btn" onclick="animSquare(1)">1. 長方形を割る</button>
                <button class="btn" onclick="animSquare(2)">2. 下に移動</button>
                <button class="btn" onclick="animSquare(3)">3. 穴を埋める</button>
                <button class="btn" onclick="animSquare(0)">リセット</button>
            </div>
            <p id="sq-status" style="height: 1.5em; margin-top:5px;">$x^2 + 4x$ は「正方形＋長方形」</p>
        </div>
    </div>

    <div class="slide">
        <h2>「標準形」ならグラフは簡単</h2>
        <p style="margin:0;">$y = a(x-p)^2 + q$</p>
        
        <div style="display:flex; flex-direction:column; align-items:center; width:100%; height:90%;">
            <div class="box" style="margin: 5px 0; padding: 10px 20px;">
                <p style="margin:0; font-size:1.3rem;">頂点： $(p, q)$　/　形： $a$ (開き具合)</p>
            </div>
            
            <div class="interactive-area" style="padding: 10px; margin-top: 5px; width: 100%;">
                <svg id="svg-graph" viewBox="-6 -6 12 12" style="background:#111; border:1px solid #444; height:200px; width:100%; max-width:400px;">
                    <g id="grid-layer"></g>
                    <line x1="-10" y1="0" x2="10" y2="0" stroke="#888" stroke-width="0.1"/>
                    <line x1="0" y1="-10" x2="0" y2="10" stroke="#888" stroke-width="0.1"/>
                    <path id="graph-path" d="" stroke="var(--accent-primary)" stroke-width="0.2" fill="none"/>
                    <circle id="vertex-point" cx="0" cy="0" r="0.3" fill="var(--accent-secondary)"/>
                </svg>

                <div class="slider-container">
                    <div class="slider-row">
                        <div class="slider-label" style="color:var(--accent-primary);">a=<span id="val-a">1.0</span></div>
                        <input type="range" id="input-a" min="-3" max="3" step="0.1" value="1" oninput="updateGraphVertex()">
                    </div>
                    <div class="slider-row">
                        <div class="slider-label" style="color:var(--accent-secondary);">p=<span id="val-p">2.0</span></div>
                        <input type="range" id="input-p" min="-4" max="4" step="0.5" value="2" oninput="updateGraphVertex()">
                    </div>
                    <div class="slider-row">
                        <div class="slider-label" style="color:var(--accent-tertiary);">q=<span id="val-q">-1.0</span></div>
                        <input type="range" id="input-q" min="-4" max="4" step="0.5" value="-1" oninput="updateGraphVertex()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="slide">
        <h2>二次不等式の解き方（本質）</h2>
        <div class="box">
            <p style="font-size: 2rem;">$x^2 - 4x + 3 > 0$</p>
        </div>
        <p class="fragment">1. グラフを描く（交点を求める）</p>
        <p class="fragment highlight" style="font-size: 1.8rem;">2. 「水面(x軸)より上か下か」を見る</p>
    </div>

    <div class="slide">
        <h2>【視覚化】上側か、下側か</h2>
        <div class="interactive-area">
            <svg id="svg-quad" viewBox="0 0 400 300">
                <line x1="0" y1="150" x2="400" y2="150" stroke="#888" stroke-width="2"/>
                <text x="380" y="140" fill="#888" text-anchor="end">y = 0</text>
                <path id="main-parabola" d="" stroke="#555" stroke-width="2" fill="none"/>
                <path id="quad-highlight" d="" stroke-width="6" fill="none" stroke-linecap="round"/>
                <circle cx="129" cy="150" r="6" fill="white"/>
                <circle cx="271" cy="150" r="6" fill="white"/>
                <text x="129" y="180" fill="white" text-anchor="middle" font-size="18">α</text>
                <text x="271" y="180" fill="white" text-anchor="middle" font-size="18">β</text>
            </svg>
            <div style="display:flex; gap:20px; margin-top:20px;">
                <button class="btn" onclick="setQuadMode('gt')">$> 0$ (上側)</button>
                <button class="btn" onclick="setQuadMode('lt')">$< 0$ (下側)</button>
            </div>
            <p id="quad-result" class="highlight" style="margin-top:10px; height: 1.5em;">ボタンを押して範囲を確認</p>
        </div>
    </div>

    <div class="slide">
        <h2>判別式とグラフの関係まとめ</h2>
        <table style="font-size: 1rem;">
            <tr><th>判別式 $D$</th><th>$D > 0$</th><th>$D = 0$</th><th>$D < 0$</th></tr>
            <tr><td>解の個数</td><td>異なる2つの実数解</td><td>1つの実数解（重解）</td><td>実数解なし</td></tr>
            <tr>
                <td>グラフ</td>
                <td>
                    <svg viewBox="0 0 100 60" style="height:60px;">
                        <line x1="0" y1="30" x2="100" y2="30" stroke="#fff" stroke-width="1.5"/>
                        <path d="M 10 10 Q 50 80 90 10" stroke="var(--accent-primary)" fill="none" stroke-width="2"/>
                        <circle cx="28" cy="30" r="2.5" fill="white"/>
                        <circle cx="72" cy="30" r="2.5" fill="white"/>
                    </svg>
                </td>
                <td>
                    <svg viewBox="0 0 100 60" style="height:60px;">
                        <line x1="0" y1="40" x2="100" y2="40" stroke="#fff" stroke-width="1.5"/>
                        <path d="M 10 0 Q 50 80 90 0" stroke="var(--accent-secondary)" fill="none" stroke-width="2"/>
                        <circle cx="50" cy="40" r="2.5" fill="white"/>
                    </svg>
                </td>
                <td>
                    <svg viewBox="0 0 100 60" style="height:60px;">
                        <line x1="0" y1="50" x2="100" y2="50" stroke="#fff" stroke-width="1.5"/>
                        <path d="M 10 0 Q 50 40 90 0" stroke="var(--accent-tertiary)" fill="none" stroke-width="2"/>
                    </svg>
                </td>
            </tr>
            <tr><td>共有点</td><td>2個（交わる）</td><td>1個（接する）</td><td>0個（浮く）</td></tr>
        </table>
    </div>

    <div class="slide">
        <h2>応用：自動ブレーキの仕組み</h2>
        <div style="display: flex; flex-direction: column; width: 100%; max-width: 900px; gap: 10px;">
            <div class="box" style="text-align: left; background: rgba(0,210,255,0.05); padding: 15px; width: auto;">
                <p style="margin:0; font-size:1.2rem;">
                    <strong>停止距離 $\propto$ 速度の2乗</strong>：速度が2倍だと距離は4倍。<br>
                    <strong>不等式</strong>： $\text{停止距離}(v) \le \text{前方との距離}$ が崩れるとブレーキ作動。
                </p>
            </div>
            <div class="interactive-area" style="width: 100%; padding: 10px;">
                <div style="width:90%; display:flex; align-items:center; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:1.2rem;">速度 $v$</span>
                    <input type="range" id="brake-speed" min="0" max="100" value="40" oninput="updateBrake()">
                    <span id="speed-val" style="font-size:1.2rem; width:50px; text-align:right;">40</span>
                </div>
                <svg id="brake-sim" viewBox="0 0 800 120" style="background:#222; border-radius:10px; max-height: 200px;">
                    <rect x="0" y="80" width="800" height="40" fill="#444"/>
                    <line x1="0" y1="100" x2="800" y2="100" stroke="#fff" stroke-dasharray="20"/>
                    <g id="car-group" transform="translate(50, 60)">
                        <rect x="0" y="0" width="60" height="30" fill="var(--accent-primary)"/>
                        <circle cx="15" cy="30" r="8" fill="#aaa"/>
                        <circle cx="45" cy="30" r="8" fill="#aaa"/>
                    </g>
                    <rect x="700" y="30" width="20" height="90" fill="#888"/>
                    <line x1="110" y1="60" x2="700" y2="60" stroke="#888" stroke-width="2" marker-end="url(#arrow-grey)"/>
                    <text x="400" y="50" fill="#888" text-anchor="middle" font-size="14">距離 (一定)</text>
                    <rect id="stop-dist-bar" x="110" y="70" width="0" height="8" fill="var(--accent-tertiary)" opacity="0.7"/>
                    <text id="alert-msg" x="400" y="60" fill="var(--accent-secondary)" font-size="30" font-weight="bold" text-anchor="middle" opacity="0">BRAKE!</text>
                    <defs>
                        <marker id="arrow-grey" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#888" /></marker>
                    </defs>
                </svg>
                <p id="ineq-status" style="font-size:1.4rem; margin: 5px 0;">OK: 安全圏内</p>
            </div>
        </div>
    </div>

    <div class="slide">
        <h1>お疲れ様でした</h1>
        <p>数学基礎講座 終了</p>
        <p>「範囲」を扱う不等式と、2乗の性質を持つ二次関数を学びました。<br>これらは科学や工学の基礎となる重要な道具です。</p>
        <div style="margin-top:50px;">
            <button class="btn" onclick="goToSlide(0)">最初に戻る</button>
        </div>
    </div>
    
    <div class="slide"></div><div class="slide"></div>

</div>

<div id="controls">
    <button class="btn" onclick="prevStep()">◀</button>
    <button class="btn" onclick="nextStep()">▶</button>
</div>
<div id="progress-bar"></div>
<div id="slide-number">1 / 50</div>

<script>
    /* =========================================
       Slide Navigation System
       ========================================= */
    const slides = document.querySelectorAll('.slide');
    const progressBar = document.getElementById('progress-bar');
    const slideNumberDisplay = document.getElementById('slide-number');
    let currentSlide = 0;

    // Initialize slides
    slides.forEach(slide => {
        slide.dataset.currentFragment = -1;
        slide.dataset.totalFragments = slide.querySelectorAll('.fragment').length;
    });

    function updateView() {
        slides.forEach((slide, index) => {
            slide.classList.remove('active', 'past');
            if (index === currentSlide) {
                slide.classList.add('active');
            } else if (index < currentSlide) {
                slide.classList.add('past');
            }
        });
        
        // Count valid slides (exclude buffer empty slides at end)
        const totalValidSlides = slides.length - 2; 
        const progress = ((currentSlide + 1) / totalValidSlides) * 100;
        progressBar.style.width = `${Math.min(progress, 100)}%`;
        slideNumberDisplay.textContent = `${currentSlide + 1} / ${totalValidSlides}`;
    }

    function nextStep() {
        const slide = slides[currentSlide];
        const totalFragments = parseInt(slide.dataset.totalFragments);
        let currentFragment = parseInt(slide.dataset.currentFragment);

        if (currentFragment < totalFragments - 1) {
            currentFragment++;
            const fragments = slide.querySelectorAll('.fragment');
            fragments[currentFragment].classList.add('visible');
            slide.dataset.currentFragment = currentFragment;
        } else {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                updateView();
            }
        }
    }

    function prevStep() {
        const slide = slides[currentSlide];
        let currentFragment = parseInt(slide.dataset.currentFragment);

        if (currentFragment >= 0) {
            const fragments = slide.querySelectorAll('.fragment');
            fragments[currentFragment].classList.remove('visible');
            slide.dataset.currentFragment = currentFragment - 1;
        } else {
            if (currentSlide > 0) {
                currentSlide--;
                updateView();
            }
        }
    }

    function goToSlide(index) {
        slides.forEach(slide => {
            slide.dataset.currentFragment = -1;
            slide.querySelectorAll('.fragment').forEach(f => f.classList.remove('visible'));
        });
        currentSlide = index;
        updateView();
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'Enter') nextStep();
        if (e.key === 'ArrowLeft') prevStep();
    });

    /* =========================================
       Interactive: Balance Scale
       ========================================= */
    let leftWeight = 0;
    let rightWeight = 0;

    function addWeight(side) {
        const g = document.getElementById(side + '-weights');
        const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        const count = g.children.length;
        // Stack weights visually
        rect.setAttribute("x", side === 'left' ? 25 : 325);
        rect.setAttribute("y", 90 - (count * 12));
        rect.setAttribute("width", 50);
        rect.setAttribute("height", 10);
        rect.setAttribute("fill", side === 'left' ? "var(--accent-primary)" : "var(--accent-secondary)");
        rect.setAttribute("stroke", "#222");
        g.appendChild(rect);

        if(side === 'left') leftWeight += 10;
        else rightWeight += 10;
        
        updateScaleAngle();
    }

    function resetScale() {
        leftWeight = 0; rightWeight = 0;
        document.getElementById('left-weights').innerHTML = '';
        document.getElementById('right-weights').innerHTML = '';
        updateScaleAngle();
    }

    function updateScaleAngle() {
        const arm = document.getElementById('scale-arm');
        const status = document.getElementById('scale-status');
        
        let diff = rightWeight - leftWeight;
        // Limit rotation to +/- 20 degrees
        let angle = Math.max(-20, Math.min(20, diff)); 
        
        arm.setAttribute("transform", `rotate(${angle}, 200, 50)`);

        if (leftWeight > rightWeight) {
            status.innerHTML = "左 ＞ 右";
            status.style.color = "var(--accent-primary)";
        } else if (leftWeight < rightWeight) {
            status.innerHTML = "左 ＜ 右";
            status.style.color = "var(--accent-secondary)";
        } else {
            status.innerHTML = "左 ＝ 右";
            status.style.color = "#fff";
        }
    }

    /* =========================================
       Interactive: Flip Animation
       ========================================= */
    function updateFlip() {
        const angle = document.getElementById('flip-slider').value;
        const rad = angle * (Math.PI / 180);
        const group = document.getElementById('flip-obj');
        
        const scaleX = Math.cos(rad);
        
        const x1 = 50 * scaleX;
        const x3 = 150 * scaleX;
        
        let html = '';
        const color1 = "var(--accent-primary)";
        const color3 = "var(--accent-secondary)";
        
        html += `<circle cx="${x1}" cy="0" r="5" fill="${color1}"/>`;
        html += `<text x="${x1}" y="-15" fill="${color1}" text-anchor="middle">1</text>`;
        html += `<circle cx="${x3}" cy="0" r="5" fill="${color3}"/>`;
        html += `<text x="${x3}" y="-15" fill="${color3}" text-anchor="middle">3</text>`;
        
        let text = "";
        if(angle < 90) text = "1 < 3";
        else text = "-1 > -3";
        
        html += `<text x="${(x1+x3)/2}" y="-35" fill="#fff" text-anchor="middle" font-size="20">${text}</text>`;
        
        group.innerHTML = html;
    }

    /* =========================================
       Interactive: Tool (Fixed)
       ========================================= */
    function updateTool() {
        const a = parseFloat(document.getElementById('tool-a').value);
        const b = parseFloat(document.getElementById('tool-b').value);
        const op = document.getElementById('tool-op').value;
        
        const step1 = document.getElementById('tool-step1');
        const step2 = document.getElementById('tool-step2');
        const ans = document.getElementById('tool-ans');
        
        let opSign = "";
        if(op === 'gt') opSign = ">";
        if(op === 'lt') opSign = "<";
        if(op === 'ge') opSign = "\\ge";
        if(op === 'le') opSign = "\\le";
        
        step1.innerHTML = `$ ${a}x ${b >= 0 ? '+ '+b : b} ${opSign} 0 $`;
        step2.innerHTML = `$ ${a}x ${opSign} ${-b} $`;
        
        let resVal = -b / a;
        let resOp = opSign;
        
        // Check for flip
        if(a < 0) {
            if(op === 'gt') resOp = "<";
            else if(op === 'lt') resOp = ">";
            else if(op === 'ge') resOp = "\\le";
            else if(op === 'le') resOp = "\\ge";
        }
        
        let dispVal = Number.isInteger(resVal) ? resVal : resVal.toFixed(2);
        ans.innerHTML = `$ x ${resOp} ${dispVal} $`;
        
        MathJax.typesetPromise([step1, step2, ans]);
        drawToolNumberLine(resVal, resOp);
    }

    function drawToolNumberLine(val, op) {
        const svg = document.getElementById('tool-svg');
        svg.innerHTML = '';
        
        const axis = document.createElementNS("http://www.w3.org/2000/svg", "line");
        axis.setAttribute("x1", 20); axis.setAttribute("y1", 80);
        axis.setAttribute("x2", 380); axis.setAttribute("y2", 80);
        axis.setAttribute("stroke", "#fff");
        svg.appendChild(axis);
        
        const cx = 200;
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", cx); label.setAttribute("y", 110);
        label.setAttribute("fill", "white"); label.setAttribute("text-anchor", "middle");
        label.textContent = Number.isInteger(val) ? val : val.toFixed(2);
        svg.appendChild(label);
        
        const isGe = op.includes("ge");
        const isLe = op.includes("le");
        const isGt = op === ">";
        const isLt = op === "<";
        
        const color = "var(--accent-primary)";
        const filled = (isGe || isLe);
        const directionRight = (isGt || isGe);
        
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", cx); circle.setAttribute("cy", 80);
        circle.setAttribute("r", 8);
        if(filled) {
            circle.setAttribute("fill", color);
        } else {
            circle.setAttribute("stroke", color);
            circle.setAttribute("stroke-width", 3);
            circle.setAttribute("fill", "#000");
        }
        svg.appendChild(circle);
        
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("stroke", color);
        line.setAttribute("stroke-width", 3);
        
        if (filled) {
            line.setAttribute("x1", cx); line.setAttribute("y1", 80);
            line.setAttribute("x2", cx); line.setAttribute("y2", 30);
            const hLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            hLine.setAttribute("x1", cx); hLine.setAttribute("y1", 30);
            hLine.setAttribute("x2", directionRight ? 380 : 20); hLine.setAttribute("y2", 30);
            hLine.setAttribute("stroke", color); hLine.setAttribute("stroke-width", 3);
            svg.appendChild(line);
            svg.appendChild(hLine);
        } else {
            const startX = directionRight ? cx + 6 : cx - 6;
            const startY = 74;
            const midX = directionRight ? cx + 30 : cx - 30;
            const midY = 30;
            line.setAttribute("x1", startX); line.setAttribute("y1", startY);
            line.setAttribute("x2", midX); line.setAttribute("y2", midY);
            const hLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            hLine.setAttribute("x1", midX); hLine.setAttribute("y1", midY);
            hLine.setAttribute("x2", directionRight ? 380 : 20); hLine.setAttribute("y2", midY);
            hLine.setAttribute("stroke", color); hLine.setAttribute("stroke-width", 3);
            svg.appendChild(line);
            svg.appendChild(hLine);
        }
    }

    /* =========================================
       Interactive: Simultaneous Tool (Fixed to Polygon)
       ========================================= */
    function updateSimTool() {
        const a1 = parseFloat(document.getElementById('sim-a1').value);
        const b1 = parseFloat(document.getElementById('sim-b1').value);
        const op1 = document.getElementById('sim-op1').value;
        const a2 = parseFloat(document.getElementById('sim-a2').value);
        const b2 = parseFloat(document.getElementById('sim-b2').value);
        const op2 = document.getElementById('sim-op2').value;

        // Solve 1
        let val1 = -b1 / a1;
        let right1 = (op1 === 'gt' || op1 === 'ge');
        if (a1 < 0) right1 = !right1;
        let eq1 = (op1 === 'ge' || op1 === 'le');
        
        // Solve 2
        let val2 = -b2 / a2;
        let right2 = (op2 === 'gt' || op2 === 'ge');
        if (a2 < 0) right2 = !right2;
        let eq2 = (op2 === 'ge' || op2 === 'le');
        
        drawSimNumberLine(val1, right1, eq1, val2, right2, eq2);
        
        // Generate simple text result (kept simple for robustness)
        let lower = -Infinity, upper = Infinity;
        let lowerEq = false, upperEq = false;
        
        if (right1) { lower = val1; lowerEq = eq1; } else { upper = val1; upperEq = eq1; }
        if (right2) { 
            if (val2 > lower) { lower = val2; lowerEq = eq2; }
            else if (val2 === lower && !eq2) { lowerEq = false; }
        } else {
            if (val2 < upper) { upper = val2; upperEq = eq2; }
            else if (val2 === upper && !eq2) { upperEq = false; }
        }
        
        const txt = document.getElementById('sim-result-text');
        
        if (lower > upper) {
            txt.textContent = "共通範囲： 解なし";
        } else if (lower === upper) {
            if (lowerEq && upperEq) txt.innerHTML = `共通範囲： $x = ${Number.isInteger(lower)?lower:lower.toFixed(2)}$`;
            else txt.textContent = "共通範囲： 解なし";
        } else {
            let s = "共通範囲： ";
            if (lower !== -Infinity && upper !== Infinity) {
                s += `$ ${Number.isInteger(lower)?lower:lower.toFixed(2)} ${lowerEq?'\\le':'<'} x ${upperEq?'\\le':'<'} ${Number.isInteger(upper)?upper:upper.toFixed(2)} $`;
            } else if (lower !== -Infinity) {
                s += `$ x ${lowerEq?'\\ge':'>'} ${Number.isInteger(lower)?lower:lower.toFixed(2)} $`;
            } else if (upper !== Infinity) {
                s += `$ x ${upperEq?'\\le':'<'} ${Number.isInteger(upper)?upper:upper.toFixed(2)} $`;
            } else {
                s += "全実数";
            }
            txt.innerHTML = s;
        }
        MathJax.typesetPromise([txt]);
    }
    
    function drawSimNumberLine(v1, r1, e1, v2, r2, e2) {
        const svg = document.getElementById('sim-svg');
        svg.innerHTML = '';
        
        let minV = Math.min(v1, v2);
        let maxV = Math.max(v1, v2);
        let span = maxV - minV;
        if (span === 0) span = 2; 
        
        const padding = span * 0.5;
        const viewMin = minV - padding;
        const viewMax = maxV + padding;
        const width = 360;
        
        function mapX(v) {
            return 20 + ((v - viewMin) / (viewMax - viewMin)) * width;
        }
        
        const x1 = mapX(v1);
        const x2 = mapX(v2);
        
        const axis = document.createElementNS("http://www.w3.org/2000/svg", "line");
        axis.setAttribute("x1", 20); axis.setAttribute("y1", 100);
        axis.setAttribute("x2", 380); axis.setAttribute("y2", 100);
        axis.setAttribute("stroke", "#fff");
        svg.appendChild(axis);
        
        function drawRange(x, isRight, isEq, color, yBase, yHeight) {
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            
            // 1. Draw Fill Area (Polygon for correct slant)
            const poly = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            poly.setAttribute("fill", color);
            poly.setAttribute("opacity", 0.2);
            
            const endX = isRight ? 380 : 20;
            let points = "";
            
            if (isEq) {
                // Vertical: Simple Rectangle points
                points = `${x},${yBase} ${x},${yHeight} ${endX},${yHeight} ${endX},${yBase}`;
            } else {
                // Slanted: Calculate slant X at top
                // Standard visual: shift 10px or 5px for slant
                const slantX = isRight ? x + 10 : x - 10;
                // Avoid overlap with circle at base slightly, but transparency handles it.
                // Points: Bottom(Circle center) -> Top(Slant) -> Top(End) -> Bottom(End)
                points = `${x},${yBase} ${slantX},${yHeight} ${endX},${yHeight} ${endX},${yBase}`;
            }
            poly.setAttribute("points", points);
            g.appendChild(poly); // Append Fill First
            
            // 2. Draw Outline
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", x); circle.setAttribute("cy", yBase);
            circle.setAttribute("r", 6);
            
            const line = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
            line.setAttribute("stroke", color);
            line.setAttribute("stroke-width", 3);
            line.setAttribute("fill", "none");
            
            if (isEq) {
                circle.setAttribute("fill", color);
                const endLineX = isRight ? 380 : 20;
                line.setAttribute("points", `${x},${yBase} ${x},${yHeight} ${endLineX},${yHeight}`);
            } else {
                circle.setAttribute("stroke", color); circle.setAttribute("stroke-width", 3); circle.setAttribute("fill", "#000");
                const slantX = isRight ? x + 10 : x - 10;
                const endLineX = isRight ? 380 : 20;
                // Start line slightly off circle to avoid visual clutter inside open circle? 
                // SVG open circle is on top, so it covers line start if drawn after.
                // We draw lines then circle on top.
                line.setAttribute("points", `${isRight?x+4:x-4},${yBase-5} ${slantX},${yHeight} ${endLineX},${yHeight}`);
            }
            g.appendChild(line);
            g.appendChild(circle); // Circle on top
            
            // 3. Label
            const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
            txt.setAttribute("x", x); txt.setAttribute("y", 125);
            txt.setAttribute("fill", "white"); txt.setAttribute("text-anchor", "middle");
            txt.setAttribute("font-size", "0.8rem");
            txt.textContent = Number.isInteger(Number(v1)) && x === x1 ? v1 : (x === x1 ? v1.toFixed(1) : (Number.isInteger(Number(v2)) ? v2 : v2.toFixed(1)));
            g.appendChild(txt);
            
            return g;
        }
        
        svg.appendChild(drawRange(x1, r1, e1, "var(--accent-primary)", 100, 60));
        svg.appendChild(drawRange(x2, r2, e2, "var(--accent-secondary)", 100, 40));
    }


    /* =========================================
       QUADRATIC JS FUNCTIONS (Ported)
       ========================================= */
    
    // Plot Animation (y=x^2)
    function runPlotAnimation() {
        const path = document.getElementById('plot-line');
        const pointsGroup = document.getElementById('plot-points');
        const status = document.getElementById('plot-status');
        pointsGroup.innerHTML = '';
        path.setAttribute('d', '');
        
        const keyPoints = [-3, -2, -1, 0, 1, 2, 3];
        let i = 0;

        function drawCurve() {
            let fullD = "";
            for(let x=-4; x<=4; x+=0.1) {
                let y = x*x;
                let sy = -y; 
                if(x===-4) fullD += `M ${x} ${sy}`;
                else fullD += ` L ${x} ${sy}`;
            }
            path.setAttribute('d', fullD);
        }
        
        function step() {
            if (i >= keyPoints.length) {
                status.textContent = "完成： y = x²";
                drawCurve();
                return;
            }
            const x = keyPoints[i];
            const y = x*x;
            const sy = -y; 
            status.textContent = `x = ${x} のとき...`;
            setTimeout(() => {
                status.textContent = `x = ${x} ... 2乗すると ... y = ${y}`;
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", x); circle.setAttribute("cy", sy);
                circle.setAttribute("r", 0.15); circle.setAttribute("fill", "white");
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x); line.setAttribute("y1", 0); 
                line.setAttribute("x2", x); line.setAttribute("y2", sy);
                line.setAttribute("stroke", "#555"); line.setAttribute("stroke-width", "0.05");
                line.setAttribute("stroke-dasharray", "0.2");
                pointsGroup.appendChild(line); pointsGroup.appendChild(circle);
                i++;
                setTimeout(step, 800);
            }, 600);
        }
        step();
    }

    // Square Completion Animation
    function animSquare(step) {
        const status = document.getElementById('sq-status');
        const split = document.getElementById('grp-split');
        const grp4x = document.getElementById('grp-4x');
        const rectB = document.getElementById('rect-b');
        const target = document.getElementById('sq-missing');
        const fill = document.getElementById('sq-fill');
        const txtMiss = document.getElementById('txt-missing');

        if(step === 0) {
            grp4x.setAttribute('opacity', 1);
            split.setAttribute('opacity', 0);
            rectB.setAttribute('y', 50); rectB.setAttribute('x', 250);
            rectB.setAttribute('width', 40); rectB.setAttribute('height', 100);
            target.setAttribute('opacity', 0); fill.setAttribute('opacity', 0);
            txtMiss.setAttribute('opacity', 0);
            status.textContent = "$x^2 + 4x$ は「正方形＋長方形」";
            MathJax.typesetPromise([status]);
            return;
        }
        if(step === 1) {
            grp4x.setAttribute('opacity', 0); split.setAttribute('opacity', 1);
            status.textContent = "1. 長方形 $4x$ を半分 ($2x, 2x$) に割る";
            MathJax.typesetPromise([status]);
        }
        if(step === 2) {
            rectB.style.transition = "all 1s";
            rectB.setAttribute('x', 100); rectB.setAttribute('y', 150);
            rectB.setAttribute('width', 100); rectB.setAttribute('height', 40); 
            status.textContent = "2. 半分を下に移動する";
        }
        if(step === 3) {
            target.setAttribute('x', 200); target.setAttribute('y', 150);
            fill.setAttribute('x', 200); fill.setAttribute('y', 150);
            target.setAttribute('opacity', 1);
            setTimeout(() => {
                txtMiss.setAttribute('opacity', 1); txtMiss.setAttribute('x', 220); txtMiss.setAttribute('y', 175);
                fill.setAttribute('opacity', 1);
                status.innerHTML = "3. 空いた角を埋めるには $2 \\times 2 = 4$ が必要";
                MathJax.typesetPromise([status]);
            }, 500);
        }
    }

    // Vertex Graph
    function drawGridVertex() {
        const grid = document.getElementById('grid-layer');
        grid.innerHTML = '';
        for(let x = -10; x <= 10; x+=1) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", x); line.setAttribute("y1", -10);
            line.setAttribute("x2", x); line.setAttribute("y2", 10);
            line.setAttribute("stroke", "#333"); line.setAttribute("stroke-width", "0.05");
            grid.appendChild(line);
        }
        for(let y = -10; y <= 10; y+=1) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", -10); line.setAttribute("y1", y);
            line.setAttribute("x2", 10); line.setAttribute("y2", y);
            line.setAttribute("stroke", "#333"); line.setAttribute("stroke-width", "0.05");
            grid.appendChild(line);
        }
    }
    drawGridVertex();

    function updateGraphVertex() {
        const a = parseFloat(document.getElementById('input-a').value);
        const p = parseFloat(document.getElementById('input-p').value);
        const q = parseFloat(document.getElementById('input-q').value);
        document.getElementById('val-a').textContent = a.toFixed(1);
        document.getElementById('val-p').textContent = p.toFixed(1);
        document.getElementById('val-q').textContent = q.toFixed(1);
        const vDot = document.getElementById('vertex-point');
        vDot.setAttribute('cx', p); vDot.setAttribute('cy', -q);
        let d = "M"; let started = false;
        for (let x = -10; x <= 10; x += 0.1) {
            const y = a * Math.pow(x - p, 2) + q;
            const plotY = -y; 
            if (plotY > 10 || plotY < -10) continue; 
            if (!started) { d += ` ${x} ${plotY}`; started = true; } else { d += ` L ${x} ${plotY}`; }
        }
        document.getElementById('graph-path').setAttribute('d', d);
    }
    updateGraphVertex();

    // Quadratic Inequality
    function generatePath(mode) {
        let d = "";
        let segments = [];
        if (!mode) segments.push([0, 400]);
        else if (mode === 'lt') segments.push([129, 271]);
        else { segments.push([0, 129]); segments.push([271, 400]); }
        segments.forEach(seg => {
            for (let x = seg[0]; x <= seg[1]; x+=5) {
                let val = 0.01 * Math.pow(x - 200, 2) - 50;
                let sy = 150 - val; 
                if (x === seg[0]) d += `M ${x} ${sy}`; else d += ` L ${x} ${sy}`;
            }
        });
        return d;
    }
    document.getElementById('main-parabola').setAttribute('d', generatePath(null));

    function setQuadMode(mode) {
        const path = document.getElementById('quad-highlight');
        const text = document.getElementById('quad-result');
        path.setAttribute('d', generatePath(mode));
        if (mode === 'gt') {
            path.setAttribute('stroke', 'var(--accent-secondary)');
            text.innerHTML = '上側 ($>0$) $\\to$ 外側'; text.style.color = 'var(--accent-secondary)';
        } else {
            path.setAttribute('stroke', 'var(--accent-primary)');
            text.innerHTML = '下側 ($<0$) $\\to$ 内側'; text.style.color = 'var(--accent-primary)';
        }
        MathJax.typesetPromise([text]);
    }

    // Auto Brake
    function updateBrake() {
        const v = parseInt(document.getElementById('brake-speed').value);
        document.getElementById('speed-val').textContent = v;
        const dist = 0.06 * v * v; 
        const bar = document.getElementById('stop-dist-bar');
        const alert = document.getElementById('alert-msg');
        const status = document.getElementById('ineq-status');
        bar.setAttribute('width', dist);
        const limit = 590; 
        if (dist > limit) {
            bar.setAttribute('fill', 'var(--accent-secondary)');
            alert.setAttribute('opacity', 1);
            status.innerHTML = `<span class="warn">危険！</span> 停止距離(${dist.toFixed(0)}) > 距離`;
            status.style.color = 'var(--accent-secondary)';
        } else {
            bar.setAttribute('fill', 'var(--accent-tertiary)');
            alert.setAttribute('opacity', 0);
            status.innerHTML = `OK: 停止距離(${dist.toFixed(0)}) $\\le$ 距離`;
            status.style.color = 'var(--accent-tertiary)';
        }
        MathJax.typesetPromise([status]);
    }

    // Initial Calls
    updateTool();
    updateSimTool();
    updateView();

</script>
</body>
</html>